<!doctype html>
<html>
  <head>
    <title>Locales y Viviendas en Aragón</title>
    <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="js/awesomplete.js"></script>
    <script src="js/config/config.js"></script>
    
    <link href="css/awesomplete.css" rel="stylesheet">
    <link rel="stylesheet" href="font-awesome/css/font-awesome.css" rel="stylesheet">

    
    <script src="js/jquery.js"></script>
 
    <link rel="stylesheet" href="css/nouislider.min.css">
    <link rel="stylesheet" href="css/nouislider.tooltips.css">
    <link href="css/menu.css" rel="stylesheet">
    
    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    <script src="js/nouislider.min.js"></script>
    <script src="js/wnumb.js"></script>

    <script src="js/jquery.mobile-1.4.5.min.js"></script>
    <link rel="stylesheet" href="css/jquery.mobile-1.4.5.min.css">
    <script src="js/d3.js"></script>
    <script src="js/d3_tip.js"></script>
    <script src="js/compara.js"></script>

    <link rel="stylesheet" href="css/ol.css" type="text/css" />
    <link rel="stylesheet" href="css/index.css" type="text/css" />
    
 

    <link rel="stylesheet" href="css/popup.css" type="text/css" />
    <script src="js/ol.js"></script>
    <script src="js/importDB.js"></script>
    <script src="js/jquery.dotdotdot.min.js"></script>
    <link href="css/nouislider.min.css" rel="stylesheet">
    <script src="js/mapa.js"></script>
    <script src="js/popup.js"></script>
    <script src="js/ol3-geocoder.js"></script>

    <link href="css/swipe.css" rel="stylesheet">
    <script src="js/swiper.min.js"></script>
  </head>
  <body>     

    <div data-role="page" id="pageone">
      <div id="map" class="map"></div>
      <div id="selectYear">
        <div style="">
          <div>
            <text id="labelAnyo">Año</text>
          </div>
          <select style="" name="select-choice" id="select-year">
          </select>
        </div>
      </div>
      <div id="panel" class="ol3-geocoder-container ol-geolocate ol-control mapaJuan" ><button id="locateMe"><i class="fa fa-location-arrow icon-white" aria-hidden="true"></i></button></div>
      <div id="location" class="marker mapaJuan"  ><i class="fa fa-location-arrow" aria-hidden="true"></i></div>
      

      <div id="footer" data-role="footer" data-id="foo1" data-position="fixed" data-fullscreen="true" disableAutohide="true" data-tap-toggle="false">
        <div id="bottomElements">
          <select name="flip-1" id="flipLocal" data-role="slider">
            <option value="off">Vivienda</option>
            <option value="on">Locales</option>
          </select> 
          <select name="flip-1" id="flipPdi" data-role="slider">
            <option value="off">Calles</option>
            <option value="on">Colegios</option>
          </select>
        </div>
        <div data-role="navbar" >
            <ul>
                <li><a id="mapLink" href="#pageone" data-transition="slide" data-direction="reverse" ><i id="mapIcon" class="fa fa-map-o fa-2x" aria-hidden="true"></i></a></li>
                <li><a id="comparaLink" onclick="noLoadChart()" href="#pagetwo" data-transition="slide""><i id="comparadorIcon" class="fa fa-line-chart fa-2x" aria-hidden="true"></i></a></li>
                <li><a id="creditosLink" href="#creditos" data-transition="slide"><i class="fa fa-info-circle fa-2x" aria-hidden="true"></i></a></li>
            </ul>
        </div><!-- /navbar -->
      </div><!-- /footer -->
    </div> 

    <div data-role="page" id="pagetwo">
     <div id="comparador" data-role="main">
      <div id="content" class="ui-content">
        <ul class="ui-grid-solo no-margin">
          <li class="ui-block-a"><div class="ui-block-lat pull-right"><i onclick="clearCalle('calles1')"  class="fa fa-minus-square-o fa-2x icon-granate"></i></div><div class="ui-block-lat pull-right"><a id="goToMap1"><i class="fa fa-map-marker fa-2x icon-steelblue"></i></a></div><a href="#itemComparar1" data-rel="popup" class="ui-link ui-btn no-padding no-margin"><div class="ui-block-lat pull-left"><div class="circulos"><i class="fa fa-circle icon-top"><i> Máx</i></i><i class="fa fa-circle icon-medio"><i> Med</i></i><i class="fa fa-circle icon-bottom"><i> Mín</i></i></div></div><p id="textoPrincipal1" class="textoPrincipal">Seleccionar elemento...</p><p id="textoSecundario1" class="textoSecundario dot-ellipsis"></p></a></li>
          <li class="ui-block-a"><p id="cvsc">VS</p></li>
          <li class="ui-block-a"><div class="ui-block-lat pull-right"><i onclick="clearCalle('calles2')"  class="fa fa-minus-square-o fa-2x icon-granate"></i></div><div class="ui-block-lat pull-right"><a id="goToMap2"><i class="fa fa-map-marker fa-2x icon-steelblue"></i></a></div><a disabled="true" href="#itemComparar2" data-rel="popup" class="ui-link ui-btn no-padding no-margin"><div class="ui-block-lat pull-left"><div class="circulos"><i class="fa fa-circle icon-sectop"><i> Máx</i></i><i class="fa fa-circle icon-secmedio"><i> Med</i></i><i class="fa fa-circle icon-secbottom"><i> Mín</i></i></div></div><p id="textoPrincipal2" class="textoPrincipal">Seleccionar elemento...</p><p id="textoSecundario2" class="textoSecundario dot-ellipsis"></p></a></li>
        </ul> 
            
        <div data-role="popup" id="itemComparar1" class="popup">
          <div class="inline">
            <label class="lblLocalidad">Localidad </label>
            <div class="blockLocalidad">
              <input id="localidad1" class="inputLoc" align="left" />
            </div>
            <div class="searchDiv">
              <button id="dropLoc" class="dropbtn">
                <a><i class="fa fa-search icon-steelblue" aria-hidden="true"></i></a>
              </button>
            </div>
         </div>

          <div class="inline">
            <label class="lblCalle">Calle </label>
            <div class="calle blockCalle">
              <input id="calles1" class="calle inputCalle" align="left" />
            </div>
            <div class="searchDiv">
              <button id="drop" class="calle1 dropbtn" type="button" disabled="disabled" >
                <a><i class="fa fa-search" aria-hidden="true"></i></a>
              </button>
            </div>
          </div>
          <p>
            <h4>Últimas búsquedas</h4><a><i class="fa fa-history fa-2x" aria-hidden="true"></i></a>
          </p>
          <ul id="historial1">
          </ul>
          <!--<p>
            <h4>Más Buscadas</h4><a><i class="fa fa-fire fa-2x" aria-hidden="true"></i></a>
          </p>
          <ol>
          </ol>-->
        </div>

        <div data-role="popup" id="itemComparar2" class="popup">
          <div class="inline" id="loc">
            <label class="lblLocalidad">Localidad </label>
            <div class="blockLocalidad">
              <input class="inputLoc" id="localidad2" class="" align="left" />
            </div>
            <div class="searchDiv">
              <button id="dropLoc2" class="dropbtn">
                <a><i class="fa fa-search icon-steelblue" aria-hidden="true"></i></a>
              </button>
            </div>
            </div>

        <div  class="inline">
          <label class="lblCalle">Calle </label>
          <div class="blockCalle">
            <input id="calles2" class="calle2 inputCalle" align="left"/>
          </div>
          <div class="searchDiv">
            <button id="drop2" class="calle2 dropbtn" type="button" disabled="disabled" ><a><i class="fa fa-search" aria-hidden="true"></i></a>
            </button>
          </div>
        </div>
        <p>
          <h4>Últimas búsquedas</h4><a><i class="fa fa-history fa-2x icon-steelblue" aria-hidden="true"></i></a>
        </p>
        <ul id="historial2">
        </ul>
        <!--<p>
         <h4>Más Buscadas</h4><a><i class="fa fa-fire fa-2x" aria-hidden="true"></i></a>
        </p>
        <ol>
        </ol>-->
      </div>
        <div class="sliders" id="slider"></div>
        <div id="graph"></div>
        <div id="clearBottom"></div> 
      </div>
    </div>             
  </div> 

  <div data-role="page" id="creditos">

    <div data-role="main" style="overflow-y: scroll; margin:20px">

      <img src="img/aragon.gif">

      <h3 style="margin-top: 5%">Tutorial de la aplicación</h2>
      <p><a class="btnTut" href="#tutorial"><i class="fa fa-leanpub " aria-hidden="true" style="color:white;"></i>  Ver el Tutorial</a></p>
      <h3>Conoce más acerca de los alquileres en Aragón</h2>
      <p><a class="btnTut" href="#infografias"><i class="fa fa-info-circle" aria-hidden="true"></i>  Saber Más</a></p>

      <h3  style="margin-top: 5%">Aplicación del Gobierno de Aragón que utiliza las siguientes fuentes:</h2>
      <p><h4>Datos de fianzas</h4></p><p>D.G. Vivienda y Rehabilitación del Gobierno de Aragón y obtenidos a través de <a href="http://opendata.aragon.es" title="Aragón Open Data">Aragón Open Data</a></p>
      <p><h4>Datos de callejero</h4></p><p>Instituto Geográfico de Aragón y accesibles a través de: <a href="http://idearagon.aragon.es" title="IDEAragon">IDEAragón</a></p> 
      <p><h4>Cartografía</h4></p>
      <p><a href="http://www.openstreetmap.org/" title="OpenStreetMap">Map data © OpenStreetMap</a></p>
      <p><h4>Librerías utilizadas</h4></p>
      <p><a href="https://jquery.com/">jQuery</a>,<a href="https://openlayers.org/"> OpenLayers</a>, <a href="https://leaverou.github.io/awesomplete/">Awesomplete</a>, <a href="https://refreshless.com/nouislider/">noUiSlider</a>, <a href="https://refreshless.com/wnumb/">wNumb</a>, <a href="https://d3js.org/">d3</a>,<a href="http://fontawesome.io/">Font Awesome</a>,<a href="http://dotdotdot.frebsite.nl/">DotDotDot</a></p>
    </div>
  </div> 

  <div data-role="page" id="tutorial">
    <div data-role="main" class="ui-content">
    
      <div id="tutCont" class="ui-content">
      
      <div style="float: center; width:100%">
       <div class="swiper-container">
        
          <div class="swiper-wrapper">
            <div class="swiper-slide"><img src="img/tutorial/t1.jpg"></div>
            <div class="swiper-slide"><img src="img/tutorial/t2.jpg"></div>
            <div class="swiper-slide"><img src="img/tutorial/t3.jpg"></div>
            <div class="swiper-slide"><img src="img/tutorial/t4.jpg"></div>
            <div class="swiper-slide"><img src="img/tutorial/t5.jpg"></div>
            <div class="swiper-slide"><img src="img/tutorial/t6.jpg"></div>
            <div class="swiper-slide"><div><a style="color:red;">Fin</a></div></div>
          </div>
          <!-- Add Pagination -->
          
        </div>
        <div class="swiper-pagination"></div>
        <div class="swiper-button-next"></div>
          <div class="swiper-button-prev"></div>
        </div>
      </div>
    </div>
  </div>
    <div data-role="page" id="infografias">
    <div data-role="main" class="ui-content">
      <div>
        <a style="" href="#creditos"><i class="fa fa-backward fa-2x" aria-hidden="true"></i></a><br>
        <a style="text-decoration: none" href="#creditos">Volver</a>
      </div>
      <div id="infoCont" class="ui-content" style="margin-top:37%">
      
      <div style="float: center; width:100%">
       <div class="swiper-containerI">
          <div class="swiper-wrapper">
            <div class="swiper-slide"><div class="swiper-zoom-container">
                <img src="img/infografias/web-01.jpg">
            </div></div>
            <div class="swiper-slide"><div class="swiper-zoom-container">
                <img src="img/infografias/web-02.jpg">
            </div></div>
            <div class="swiper-slide"><div class="swiper-zoom-container">
              <img src="img/infografias/web-03.jpg">
            </div></div>
            <div class="swiper-slide"><div class="swiper-zoom-container">
              <img src="img/infografias/web-04.jpg">
            </div></div>
            <div class="swiper-slide"><div class="swiper-zoom-container">
              <img src="img/infografias/web-05.jpg">
            </div></div>
            <div class="swiper-slide"><div class="swiper-zoom-container">
              <img src="img/infografias/web-06.jpg">
            </div></div>
          </div>
          <!-- Add Pagination -->
        </div>
        <div id="paginationInfo" class="swiper-pagination"></div>
        <div class="swiper-button-next nextInfo"></div>
          <div class="swiper-button-prev prevInfo"></div>
        </div>
      </div>
    </div>
  </div>

    <script>
      $( "#itemComparar1" ).bind({
         popupafteropen: function(event, ui) {
          $("#historial1").empty()
          $("#itemComparar1 > ol").empty()
          setHistorial("1");
         }
      });
      $( "#itemComparar2" ).bind({
         popupafteropen: function(event, ui) {
          $("#historial2").empty()
          $("#itemComparar2 > ol").empty()
          setHistorial("2");
         }
      });
      function setHistorial(id)
      { 
        db.transaction(function(tx){
          tx.executeSql("SELECT distinct localidad,calle from historial where espdi='"+pdiValue+"' order by fecha desc limit 3",[],function(tx,results){
            for(var i=0;i<results.rows.length;i++)
            {
              var localidad=results.rows.item(i).localidad
              var calle=results.rows.item(i).calle
              $("#historial"+id).append('<li><a class="historiaLink" localidad="'+localidad+'" calle="'+calle+'" >'+calle+', '+localidad+'</a></li>')
            }
            /*db.transaction(function(tx){
              tx.executeSql("SELECT localidad,calle,count(*) as total from historial where espdi='"+pdiValue+"' group by c_mun_via order by total desc limit 3",[],function(tx,results){
                for(var i=0;i<results.rows.length;i++){ 
                  var localidad=results.rows.item(i).localidad
                  var calle=results.rows.item(i).calle           
                  $("#itemComparar"+id+" > ol").append('<li><a class="historiaLink" localidad="'+localidad+'" calle="'+calle+'" >'+calle+', '+localidad+'</a></li>')
                }
                $("#itemComparar"+id+" > ol > li > a.historiaLink").on("click",function(){
                  var localidad= $(this).attr("localidad");
                  var calle= $(this).attr("calle");
                  setCalleHistorial(localidad,calle,id);
                  loadChart(hideSpinner)
                })
              });
            });*/   // Se ha decidido eliminar la opción de más buscadas
            $("ul#historial"+id+" > li > a.historiaLink").on("click",function(){
              var localidad= $(this).attr("localidad");
              var calle= $(this).attr("calle");
              setCalleHistorial(localidad,calle,id);
              loadChart(hideSpinner)
            })
          });
        });
      }

      function setCalleHistorial(localidad,calle,id)
      {
        $("#calles"+id).val(calle)
        $("#localidad"+id).val(localidad)
        $("#textoPrincipal"+id).text(calle)
        $("#textoSecundario"+id).text(localidad)
        acortaTextosCalles();
        $("#itemComparar"+id).popup("close")
        $("#goToMap"+id).attr("onclick","goToMap('"+localidad+"','"+calle+"')")
        $("#historial"+id).empty();
        $(".calle"+id).prop('disabled', "");
        db.transaction(function(tx){
          if(pdiValue==0)
          {
            tx.executeSql("select c_mun_via from infoCalles where localidad='"+localidad+"' and etiqueta='"+calle+"'",[],function(tx,results){
              var c_mun_via=results.rows.item(0).c_mun_via;
              db.transaction(function(tx){
                var query="insert into historial(c_mun_via,localidad,calle,fecha,espdi) values('"+c_mun_via+"','"+localidad+"','"+calle+"',datetime('now'),'0')";
                tx.executeSql(query);
              })  
            });
          }
          else
          {
            tx.executeSql("select id_poi from infoPois where localidad='"+localidad+"' and etiqueta='"+calle+"'",[],function(tx,results){
              var id_poi=results.rows.item(0).id_poi;
              db.transaction(function(tx){
                var query="insert into historial(c_mun_via,localidad,calle,fecha,espdi) values('"+id_poi+"','"+localidad+"','"+calle+"',datetime('now'),'1')";
            tx.executeSql(query);
              })  
            });
          }
        });
        var nombres=[];
        if(pdiValue==1)
        {
          fetchPois(nombres,localidad,function(){
            if(id==1)
            {
              comboplete.list=nombres;
            }
            else
            {
              comboplete2.list=nombres;
            }
          });
        }
        else
        {
          fetchdetails(nombres,localidad,function(){
            if(id==1)
            {
              comboplete.list=nombres;
            }
            else
            {
              comboplete2.list=nombres;
            }
          });
        }
      }
      var swiper=null
      var swiperInfografias=null

      $(document).on("pageshow","#tutorial",function(event){
        if(swiper==null){
          swiper = new Swiper('.swiper-container', {
            pagination: '.swiper-pagination',
            paginationClickable: true,
            nextButton: '.swiper-button-next',
            prevButton: '.swiper-button-prev',
            onReachEnd: function(swiper) {
              //callback function code here
              location.href="#pageone"
               swiper.slideTo("0")
            }
          });
        }
      })
      $(document).on("pageshow","#infografias",function(event){
        if(swiperInfografias==null){
          swiperInfografias = new Swiper('.swiper-containerI', {
            pagination: '#paginationInfo',
            paginationClickable: true,
            zoomToggle:true,
            zoom:true,
            nextButton: '.nextInfo',
            prevButton: '.prevInfo',
            onReachEnd: function(swiper) {
              //callback function code here
              location.href="#creditos"
               swiper.slideTo("0")
            }
          });
        }
      })
      $(document).on("pageshow","#pageone",function(event){
        $(".tooltip").css("opacity","0");
        $("#mapLink").addClass("ui-btn-active");
        $("#comparaLink").removeClass("ui-btn-active");
        $("#creditosLink").removeClass("ui-btn-active");
      });
      var reloadChart=false;
      $(document).on("pageshow","#pagetwo",function(event){
        $(".tooltip").css("opacity","0");
        $("#mapLink").removeClass("ui-btn-active");
        $("#comparaLink").addClass("ui-btn-active");
        $("#creditosLink").removeClass("ui-btn-active");
        if(reloadChart==true)     // Si estoy accediendo al comparador desde el detalle de una fianza recargo el gráfico
        {
          cambiaCalle('1');
        }
      });
      $(document).on("pageshow","#creditos",function(event){
        $(".tooltip").css("opacity","0");
        $("#mapLink").removeClass("ui-btn-active");
        $("#comparaLink").removeClass("ui-btn-active");
        $("#creditosLink").addClass("ui-btn-active");
      });
      $(document).on("pagebeforeshow","#pageone",function(event){
        $("#mapLink").addClass("ui-btn-active",function(){});
        $("#comparaLink").removeClass("ui-btn-active");
        $("#creditosLink").removeClass("ui-btn-active");
        var footer=$("#footer");
        $("#pageone").append(footer);
        $("#selectYear").show();
        $("#bottomElements").show();
      });
      $(document).on("pagebeforeshow","#pagetwo",function(event){
        
        var footer=$("#footer");
        $("#comparador").append(footer)
        $("#selectYear").hide();
        $("#bottomElements").show();
      });
      $(document).on("pagebeforeshow","#creditos",function(event){
        
        var footer=$("#footer");
        $("#creditos").append(footer)
        $("#bottomElements").hide();
      });
      function acortaTextosCalles() {
        $("#textoPrincipal1").dotdotdot();
        $("#textoSecundario1").dotdotdot();
        $("#textoPrincipal2").dotdotdot();
        $("#textoSecundario2").dotdotdot();
      };
      var años="";
      var d = new Date();
      var year = d.getFullYear();
      var defaultAño=year-1;
      for(var i=year;i>1995;i--)
      {
        $("#select-year").append('<option value="'+i+'">'+i+'</option>');
      }
      $("#select-year").val(defaultAño);

      var localValue=1;
      var pdiValue=0;

      function noLoadChart()
      {
        reloadChart=false;
      }
    </script>

  </body>
</html>
